# MultiPlayerNIIES
## Многооконный плеер для синхронного воспроизведения видеофайлов. 
_Player with multi-window interface to play many video files._ 

## Licence
_This repository contains images from Gnome desktop icons pack (https://www.iconspedia.com/pack/gnome-desktop-2042/) with liscense GNU GPL v.2. The rest of this repository is licensed by WTFPL._

## Руководство по эксплуатации

### Основные понятия

##### _Лидер синхронизации_ 

Одно (только одно) окно видеопроигрывателя, которое является основным в процессе синхронизации с другими окнами. Это означает что в других окнах видеопроигрывателя смещение синхронизации **ВСЕГДА** устанавливается относительно лидера синхронизации.

##### _Титры (SRT-титры, титры с данными о времени) и временнЫе метки_

Данные, сопровождающие видео, содержащиеся в файле формата \*.srt. Для каждого отдельного титра в файле srt указывается интервал времени, когда он должен отображаться на видео и текст титра (с форматированием - цветом,шрифтом и проч). 

В принципе могут содержать любую текстовую информацию

Пример титров - одна запись (в файле srt таких записей тысячи

    10  
    00:00:01,161 --> 00:00:01,202 
    {\an9}<font face="Courier New" size="12" color="#ffffff">00;00;00;370  
    </font>

Первая строка - номер титра. Вторая - интервал времени в который он отображается - здесь титр отображается в течение 41 мсек начиная с 1 сек 161 мсек от начала видеофайла. Третья и следующие строки - данные о форматировании и текст. В качестве текста здесь некая **временнАя метка** - _00;00;00;370_ -  в данном случае это метка времени от ПО стенда о времени прошедшем с начала включения записи/старта эксперимента.

В частности титры с временными метками записываются с помощью систем видеорегистрации на стендах (ПО "Интеллект"). В этом случае титры возможно использовать для синхронизации видео. 

##### _Различия синхронизации по титрам и синхронизации по смещению_

Синхронизация по титрам осуществляется автоматически: плеер для каждого видео с титрами считывает титры, преобразует их в формат времени и сравнивает время титров каждого конкретного видео с временем титров лидера синхронизации (если лидер синхронизации не имеет титров - то возникает баг, который скоро исправлю)  

##### _Смещение синхронизации(dt)_

Например, есть 2 видео: VID1 и VID2, начинающиеся в разные моменты. Соответственно событие А на этих видео при их синхронном просмотре с начала будет видно в разные моменты времени. Таким образом для VID2 мы должны установить смещение синхронизации равное dt. В данном плеере смещение синхронизации может задаваться вручную или при наличии титров с временными метками рассчитывается автоматически на основе данных титров. 

![Схема синхронизации по смещению](https://github.com/lvovandrey/MultiPlayerNIIES/blob/Readme-Branch/ReadmeImgs/Shema.jpg)

Смещение синхронизации **ВСЕГДА** устанавливается относительно лидера синхронизации.

##### _Показатели рассинхронизации (для синхронизации по титрам и синхронизации по смещению)_

Показатель рассинхронизации - это величина, показывающая насколько сильно расходится время (с учетом установленных смещений синхронизации) на всех открытых видео в текущий момент времени.

Пример.

Допустим есть 5 открытых видео. 

Видео | Время события А на видео | Смещение синхронизации | Рассинхрон относительно лидера | Рассинхрон от лидера с учетом смещения 
--- | --- | --- | --- |--- 
Видео 1 (лидер синхронизации) | 0:20 |  0:00 |  0:00 |  0:00 
Видео 2 | 0:15 | +0:05 | -0:05 |  0:00 
Видео 3 | 0:35 | -0:20 | +0:15 | -0:05 
Видео 4 | 0:05 | +0:10 | -0:15 | -0:05
Видео 5 | 0:00 | +0:30 | -0:20 | +0:10

Видео 1 является лидером синхронизации, поэтому у него нет смещения синхронизации и ясно что оно само с собой синхронизированно идеально. Событие А наступает на этом видео на 20-й секунде.

Видео 2 включили на 5 сек позже чем Видео 1, поэтому до события А успело пройти не 20, а только 15 секунд. Таким образом рассинхрон относительно лидера составляет -5 сек. Но на Видео 2 точно выставлено смещение синхронизации, поэтому итоговый рассинхрон нивелируется - т.е. составляет 0 сек.

Аналогично для остальных видео итогорвый рассинхрон составляет -5, -5 и +10 секунд. 

В плеере показатель рассинхрона рассчитывается так: 

+ рассчитываются значения итогового рассинхрона для каждого из видео
+ из полученного перечня выбирается максимальное **по модулю** значение
+ вышеописанная операция проводится около 20 раз в секунду, при этом составляется список из 10 последних значений максимальной по модулю рассинхронизации (методом "скользящего окна")
+ из полученного списка выбирается максимальное значение, которое выводится пользователю.  


### 1. Интерфейс

![Общий вид интерфейса](https://github.com/lvovandrey/MultiPlayerNIIES/blob/Readme-Branch/ReadmeImgs/Full2.jpg) 


#### 1.1. Панель управления и таймлайн
![Панель управления](https://github.com/lvovandrey/MultiPlayerNIIES/blob/Readme-Branch/ReadmeImgs/TimeLineAndToolPanelNumered.jpg) 

#### 1.2. Видеоокно
![Видеоокно](https://github.com/lvovandrey/MultiPlayerNIIES/blob/Readme-Branch/ReadmeImgs/VideoWindowNumered.jpg) 

1. Таймлайн (лидера синхронизации)

